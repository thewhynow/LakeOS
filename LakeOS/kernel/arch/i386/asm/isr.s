.section .text

.macro IMPL_ISR num
.global ISR\num
ISR\num:
    push $0 // push dummy error code
    push $\num
    jmp isr_common
.endm

.macro IMPL_ISR_ERROR_CODE num
.global ISR\num
ISR\num:
    push $\num // cpu pushes error code to stack for certain interrupts
    jmp isr_common
.endm

isr_common:
    pusha // pushes all general-purpose registers
    
    xorl %eax, %eax
    movw %ds, %ax
    pushl %eax

    movw $0x10, %ax
    movw %ax, %ds
    movw %ax, %es
    movw %ax, %fs
    movw %ax, %gs
    movw %ax, %ss

    pushl %esp
    call ISR_handler
    addl $4, %esp

    popl %eax // restore old segment
    movw %ax, %ds
    movw %ax, %es
    movw %ax, %fs
    movw %ax, %gs
    movw %ax, %ss

    popa
    add $8, %esp // remove error code and int_num from stack 
    iret

IMPL_ISR 0
IMPL_ISR 1
IMPL_ISR 2
IMPL_ISR 3
IMPL_ISR 4
IMPL_ISR 5
IMPL_ISR 6
IMPL_ISR 7
IMPL_ISR_ERROR_CODE 8
IMPL_ISR 9
IMPL_ISR_ERROR_CODE 10
IMPL_ISR_ERROR_CODE 11
IMPL_ISR_ERROR_CODE 12
IMPL_ISR_ERROR_CODE 13
IMPL_ISR_ERROR_CODE 14
IMPL_ISR 15
IMPL_ISR 16
IMPL_ISR_ERROR_CODE 17
IMPL_ISR 18
IMPL_ISR 19
IMPL_ISR 20
IMPL_ISR_ERROR_CODE 21
IMPL_ISR 22
IMPL_ISR 23
IMPL_ISR 24
IMPL_ISR 25
IMPL_ISR 26
IMPL_ISR 27
IMPL_ISR 28
IMPL_ISR_ERROR_CODE 29
IMPL_ISR_ERROR_CODE 30
IMPL_ISR 31
IMPL_ISR 32
IMPL_ISR 33
IMPL_ISR 34
IMPL_ISR 35
IMPL_ISR 36
IMPL_ISR 37
IMPL_ISR 38
IMPL_ISR 39
IMPL_ISR 40
IMPL_ISR 41
IMPL_ISR 42
IMPL_ISR 43
IMPL_ISR 44
IMPL_ISR 45
IMPL_ISR 46
IMPL_ISR 47
IMPL_ISR 48
IMPL_ISR 49
IMPL_ISR 50
IMPL_ISR 51
IMPL_ISR 52
IMPL_ISR 53
IMPL_ISR 54
IMPL_ISR 55
IMPL_ISR 56
IMPL_ISR 57
IMPL_ISR 58
IMPL_ISR 59
IMPL_ISR 60
IMPL_ISR 61
IMPL_ISR 62
IMPL_ISR 63
IMPL_ISR 64
IMPL_ISR 65
IMPL_ISR 66
IMPL_ISR 67
IMPL_ISR 68
IMPL_ISR 69
IMPL_ISR 70
IMPL_ISR 71
IMPL_ISR 72
IMPL_ISR 73
IMPL_ISR 74
IMPL_ISR 75
IMPL_ISR 76
IMPL_ISR 77
IMPL_ISR 78
IMPL_ISR 79
IMPL_ISR 80
IMPL_ISR 81
IMPL_ISR 82
IMPL_ISR 83
IMPL_ISR 84
IMPL_ISR 85
IMPL_ISR 86
IMPL_ISR 87
IMPL_ISR 88
IMPL_ISR 89
IMPL_ISR 90
IMPL_ISR 91
IMPL_ISR 92
IMPL_ISR 93
IMPL_ISR 94
IMPL_ISR 95
IMPL_ISR 96
IMPL_ISR 97
IMPL_ISR 98
IMPL_ISR 99
IMPL_ISR 100
IMPL_ISR 101
IMPL_ISR 102
IMPL_ISR 103
IMPL_ISR 104
IMPL_ISR 105
IMPL_ISR 106
IMPL_ISR 107
IMPL_ISR 108
IMPL_ISR 109
IMPL_ISR 110
IMPL_ISR 111
IMPL_ISR 112
IMPL_ISR 113
IMPL_ISR 114
IMPL_ISR 115
IMPL_ISR 116
IMPL_ISR 117
IMPL_ISR 118
IMPL_ISR 119
IMPL_ISR 120
IMPL_ISR 121
IMPL_ISR 122
IMPL_ISR 123
IMPL_ISR 124
IMPL_ISR 125
IMPL_ISR 126
IMPL_ISR 127
IMPL_ISR 128
IMPL_ISR 129
IMPL_ISR 130
IMPL_ISR 131
IMPL_ISR 132
IMPL_ISR 133
IMPL_ISR 134
IMPL_ISR 135
IMPL_ISR 136
IMPL_ISR 137
IMPL_ISR 138
IMPL_ISR 139
IMPL_ISR 140
IMPL_ISR 141
IMPL_ISR 142
IMPL_ISR 143
IMPL_ISR 144
IMPL_ISR 145
IMPL_ISR 146
IMPL_ISR 147
IMPL_ISR 148
IMPL_ISR 149
IMPL_ISR 150
IMPL_ISR 151
IMPL_ISR 152
IMPL_ISR 153
IMPL_ISR 154
IMPL_ISR 155
IMPL_ISR 156
IMPL_ISR 157
IMPL_ISR 158
IMPL_ISR 159
IMPL_ISR 160
IMPL_ISR 161
IMPL_ISR 162
IMPL_ISR 163
IMPL_ISR 164
IMPL_ISR 165
IMPL_ISR 166
IMPL_ISR 167
IMPL_ISR 168
IMPL_ISR 169
IMPL_ISR 170
IMPL_ISR 171
IMPL_ISR 172
IMPL_ISR 173
IMPL_ISR 174
IMPL_ISR 175
IMPL_ISR 176
IMPL_ISR 177
IMPL_ISR 178
IMPL_ISR 179
IMPL_ISR 180
IMPL_ISR 181
IMPL_ISR 182
IMPL_ISR 183
IMPL_ISR 184
IMPL_ISR 185
IMPL_ISR 186
IMPL_ISR 187
IMPL_ISR 188
IMPL_ISR 189
IMPL_ISR 190
IMPL_ISR 191
IMPL_ISR 192
IMPL_ISR 193
IMPL_ISR 194
IMPL_ISR 195
IMPL_ISR 196
IMPL_ISR 197
IMPL_ISR 198
IMPL_ISR 199
IMPL_ISR 200
IMPL_ISR 201
IMPL_ISR 202
IMPL_ISR 203
IMPL_ISR 204
IMPL_ISR 205
IMPL_ISR 206
IMPL_ISR 207
IMPL_ISR 208
IMPL_ISR 209
IMPL_ISR 210
IMPL_ISR 211
IMPL_ISR 212
IMPL_ISR 213
IMPL_ISR 214
IMPL_ISR 215
IMPL_ISR 216
IMPL_ISR 217
IMPL_ISR 218
IMPL_ISR 219
IMPL_ISR 220
IMPL_ISR 221
IMPL_ISR 222
IMPL_ISR 223
IMPL_ISR 224
IMPL_ISR 225
IMPL_ISR 226
IMPL_ISR 227
IMPL_ISR 228
IMPL_ISR 229
IMPL_ISR 230
IMPL_ISR 231
IMPL_ISR 232
IMPL_ISR 233
IMPL_ISR 234
IMPL_ISR 235
IMPL_ISR 236
IMPL_ISR 237
IMPL_ISR 238
IMPL_ISR 239
IMPL_ISR 240
IMPL_ISR 241
IMPL_ISR 242
IMPL_ISR 243
IMPL_ISR 244
IMPL_ISR 245
IMPL_ISR 246
IMPL_ISR 247
IMPL_ISR 248
IMPL_ISR 249
IMPL_ISR 250
IMPL_ISR 251
IMPL_ISR 252
IMPL_ISR 253
IMPL_ISR 254
IMPL_ISR 255
